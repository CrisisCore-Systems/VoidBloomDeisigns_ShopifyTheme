<div class="glitch-image" data-glitch-image>
  <div class="glitch-image__container">
    <img class="glitch-image__original"
         src="{{ image | img_url: size }}"
         alt="{{ image.alt | escape }}"
         width="{{ width }}"
         height="{{ height }}"
         loading="{{ loading | default: 'lazy' }}">
    
    <div class="glitch-image__glitch"></div>
    <div class="glitch-image__scan-line"></div>
  </div>
</div>

{% stylesheet %}
.glitch-image {
  position: relative;
  overflow: hidden;
  
  &:hover {
    .glitch-image__glitch {
      opacity: 1;
    }
    
    .glitch-image__scan-line {
      transform: translateY(100%);
    }
  }
}

.glitch-image__glitch {
  position: absolute;
  inset: 0;
  background: inherit;
  background-position: center;
  background-size: cover;
  mix-blend-mode: difference;
  opacity: 0;
  transition: opacity 0.2s;
  animation: glitch-anim 0.2s infinite;
  pointer-events: none;
}

.glitch-image__scan-line {
  position: absolute;
  inset: 0;
  background: linear-gradient(
    transparent,
    rgba(var(--glow-primary-rgb), 0.2),
    transparent
  );
  transform: translateY(-100%);
  transition: transform 1s linear;
  pointer-events: none;
}

@keyframes glitch-anim {
  0% { transform: translate(0) }
  20% { transform: translate(-2px, 2px) }
  40% { transform: translate(-2px, -2px) }
  60% { transform: translate(2px, 2px) }
  80% { transform: translate(2px, -2px) }
  100% { transform: translate(0) }
}
{% endstylesheet %}
